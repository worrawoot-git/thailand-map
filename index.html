<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Thailand Population Map 2024 (Fixed Layout)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; font-family: 'Sarabun', sans-serif; }
        #myDiv { width: 100vw; height: 100vh; }

        /* --- ปรับปรุง: ขยับป้ายมาทางซ้าย ไม่ให้ทับแถบสี --- */
        .map-title {
            position: absolute;
            bottom: 40px;
            right: 120px;  /* ขยับจากขอบขวามา 120px (หลบแถบสี) */
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 12px 18px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            text-align: right;
            max-width: 300px;
        }
        
        .map-title h2 { margin: 0; font-size: 18px; color: #2c3e50; }
        .map-title div { font-size: 12px; color: #7f8c8d; margin-top: 5px; }

        /* กล่องแจ้งเตือน (เผื่อยังมีจังหวัดไหนชื่อไม่ตรง) */
        #error-box {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1000;
            background: rgba(192, 57, 43, 0.9);
            color: white;
            padding: 10px;
            border-radius: 5px;
            display: none; 
            font-size: 12px;
        }
    </style>
</head>
<body>

    <div class="map-title">
        <h2>ประชากรไทย 2567</h2>
        <div>กรมการปกครอง (31 ธ.ค. 67)</div>
    </div>

    <div id="error-box"></div>
    <div id="myDiv"></div>

    <script>
        // ฐานข้อมูลประชากร (เพิ่ม "Buri Ram" และเช็คชื่ออื่นๆ)
        const realPopulationDB = {
            // --- แก้ไขจุดที่มีปัญหา (Buriram) ---
            "Buri Ram": 1563600,  // ชื่อใน GeoJSON มักจะเป็นแบบนี้
            "Buriram": 1563600,   // ดักไว้เผื่อ
            
            // --- ภาคกลาง & กทม ---
            "Bangkok": 5455020, "Bangkok Metropolis": 5455020,
            "Samut Prakan": 1370000, "Nonthaburi": 1310000,
            "Pathum Thani": 1219199, "Nakhon Pathom": 925000,
            "Samut Sakhon": 602227, "Phra Nakhon Si Ayutthaya": 834082, "Ayutthaya": 834082,
            "Saraburi": 648321, "Lop Buri": 735293, "Sing Buri": 202657,
            "Chai Nat": 313392, "Ang Thong": 272587, "Nakhon Nayok": 260406,
            "Samut Songkhram": 186784, "Suphan Buri": 825595, "Kanchanaburi": 896351,
            "Ratchaburi": 865807, "Phetchaburi": 483329, "Prachuap Khiri Khan": 560408,

            // --- ภาคเหนือ ---
            "Chiang Mai": 1799019, "Chiang Rai": 1298000, "Lampang": 718790,
            "Lamphun": 399187, "Phayao": 455496, "Nan": 476727,
            "Phrae": 430669, "Mae Hong Son": 286000, "Uttaradit": 441052,
            "Tak": 684140, "Sukhothai": 581374, "Phitsanulok": 844494,
            "Phichit": 521401, "Kamphaeng Phet": 700862, "Phetchabun": 973386,
            "Nakhon Sawan": 1021827, "Uthai Thani": 322624,

            // --- ภาคอีสาน ---
            "Nakhon Ratchasima": 2620172, "Khon Kaen": 1772381, "Ubon Ratchathani": 1867942,
            "Udon Thani": 1555000, "Si Sa Ket": 1445000, "Surin": 1368000,
            "Roi Et": 1275519, "Chaiyaphum": 1105008, "Sakon Nakhon": 1140000,
            "Nakhon Phanom": 717040, "Kalasin": 962444, "Maha Sarakham": 944605,
            "Mukdahan": 351658, "Yasothon": 531542, "Amnat Charoen": 372137,
            "Nong Bua Lam Phu": 509489, "Nong Khai": 515433, "Loei": 638819,
            "Bueng Kan": 420280,

            // --- ภาคตะวันออก ---
            "Chon Buri": 1635525, "Rayong": 782171, "Chachoengsao": 733131,
            "Prachin Buri": 498456, "Sa Kaeo": 561938, "Chanthaburi": 536388, "Trat": 226922,

            // --- ภาคใต้ ---
            "Nakhon Si Thammarat": 1540000, "Songkhla": 1428000, "Surat Thani": 1075788,
            "Narathiwat": 819669, "Pattani": 736733, "Yala": 552974,
            "Trang": 638206, "Phatthalung": 523000, "Satun": 327734,
            "Chumphon": 504354, "Ranong": 192927, "Phangnga": 267994, "Phang Nga": 267994,
            "Phuket": 420993, "Krabi": 483855
        };

        const geojsonUrl = 'https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json';

        fetch(geojsonUrl)
            .then(response => response.json())
            .then(geojson => {
                
                const provinces = geojson.features.map(feature => feature.properties.name);
                const missingProvinces = [];

                const populationData = provinces.map(name => {
                    // ตัดช่องว่างหน้าหลัง
                    const cleanName = name.trim();
                    const pop = realPopulationDB[cleanName];
                    
                    if (pop === undefined) {
                        missingProvinces.push(cleanName); // เก็บชื่อที่หาไม่เจอ
                        return 0;
                    }
                    return pop;
                });

                // แจ้งเตือนถ้ายังมีจังหวัดหายไป
                if (missingProvinces.length > 0) {
                    const errorBox = document.getElementById('error-box');
                    errorBox.style.display = 'block';
                    errorBox.innerHTML = `⚠️ ชื่อไม่ตรง: ${missingProvinces.join(', ')}`;
                }

                const data = [{
                    type: "choroplethmapbox",
                    geojson: geojson,
                    locations: provinces,
                    featureidkey: "properties.name",
                    z: populationData,
                    colorscale: [
                        [0, '#eeeeee'],
                        [0.01, '#FFEDA0'],
                        [0.2, '#FED976'],
                        [0.4, '#FEB24C'],
                        [0.6, '#FD8D3C'],
                        [0.8, '#E31A1C'],
                        [1.0, '#800026']
                    ],
                    zmin: 100000,
                    zmax: 3000000,
                    marker: { opacity: 0.75, line: { width: 1, color: 'white' } },
                    text: provinces,
                    hovertemplate: "<b>%{text}</b><br>ประชากร: %{z:,} คน<extra></extra>"
                }];

                const layout = {
                    margin: { r: 0, t: 0, l: 0, b: 0 },
                    mapbox: {
                        style: "carto-positron",
                        center: { lat: 13.736717, lon: 100.523186 },
                        zoom: 5.2
                    }
                };

                Plotly.newPlot('myDiv', data, layout, {responsive: true});
            })
            .catch(error => { console.error(error); });
    </script>

</body>
</html>
