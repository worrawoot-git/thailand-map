<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Thailand Population & Density Map 2024 (Pro)</title>
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; font-family: 'Sarabun', sans-serif; background: #f4f6f9; }
        #myDiv { width: 100vw; height: 100vh; }

        /* --- ‡∏Å‡∏•‡πà‡∏≠‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏° (Control Panel) ‡∏°‡∏∏‡∏°‡∏ã‡πâ‡∏≤‡∏¢‡∏ö‡∏ô --- */
        .control-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            width: 220px;
        }

        .control-panel h3 { margin: 0 0 15px 0; font-size: 16px; color: #2c3e50; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå Dropdown */
        select {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: 'Sarabun', sans-serif;
            font-size: 14px;
            outline: none;
        }

        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏õ‡∏∏‡πà‡∏° Export */
        .btn-export {
            width: 100%;
            padding: 10px;
            background-color: #004aad; /* ‡∏™‡∏µ‡πÅ‡∏ö‡∏£‡∏ô‡∏î‡πå (‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô) */
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-family: 'Sarabun', sans-serif;
            font-weight: bold;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        .btn-export:hover { background-color: #003380; }

        /* --- ‡∏õ‡πâ‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠ (‡∏Ç‡∏ß‡∏≤‡∏•‡πà‡∏≤‡∏á) --- */
        .map-title {
            position: absolute;
            bottom: 40px;
            right: 50px; /* ‡∏Ç‡∏¢‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏™‡∏°‡∏î‡∏∏‡∏• */
            z-index: 900;
            background: rgba(255, 255, 255, 0.9);
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: right;
            border-left: 5px solid #004aad; /* ‡πÅ‡∏ñ‡∏ö‡∏™‡∏µ‡∏î‡πâ‡∏≤‡∏ô‡∏Ç‡πâ‡∏≤‡∏á */
        }
        .map-title h2 { margin: 0; font-size: 18px; color: #2c3e50; }
        .map-title div { font-size: 12px; color: #7f8c8d; margin-top: 5px; }

        #error-box {
            position: absolute; bottom: 30px; left: 20px; z-index: 1000;
            background: rgba(192, 57, 43, 0.9); color: white;
            padding: 10px; border-radius: 5px; display: none; font-size: 12px;
        }
    </style>
</head>
<body>

    <div class="control-panel">
        <h3>üó∫Ô∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•</h3>
        <select id="dataSelector" onchange="updateMapMode()">
            <option value="pop">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (‡∏Ñ‡∏ô)</option>
            <option value="density">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (‡∏Ñ‡∏ô/‡∏ï‡∏£.‡∏Å‡∏°.)</option>
        </select>
        <button class="btn-export" onclick="exportMap()">
            üì∏ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        </button>
    </div>

    <div class="map-title">
        <h2 id="titleText">‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ 2567</h2>
        <div>‡∏Å‡∏£‡∏°‡∏Å‡∏≤‡∏£‡∏õ‡∏Å‡∏Ñ‡∏£‡∏≠‡∏á (31 ‡∏ò.‡∏Ñ. 67)</div>
    </div>

    <div id="error-box"></div>
    <div id="myDiv"></div>

    <script>
        // 1. ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£ (Population)
        const populationDB = {
            "Bangkok": 5455020, "Bangkok Metropolis": 5455020,
            "Nakhon Ratchasima": 2620172, "Ubon Ratchathani": 1867942, "Chiang Mai": 1799019,
            "Khon Kaen": 1772381, "Chon Buri": 1635525, "Buri Ram": 1563600, "Buriram": 1563600,
            "Udon Thani": 1555000, "Nakhon Si Thammarat": 1540000, "Songkhla": 1428000,
            "Si Sa Ket": 1445000, "Surin": 1368000, "Roi Et": 1275519, "Samut Prakan": 1370000,
            "Chiang Rai": 1298000, "Nonthaburi": 1310000, "Sakon Nakhon": 1140000,
            "Chaiyaphum": 1105008, "Kalasin": 962444, "Nakhon Pathom": 925000, "Kanchanaburi": 896351,
            "Rayong": 782171, "Chachoengsao": 733131, "Kamphaeng Phet": 700862, "Yala": 552974,
            "Chanthaburi": 536388, "Chumphon": 504354, "Krabi": 483855, "Chai Nat": 313392,
            "Ranong": 192927, "Samut Songkhram": 186784, "Phra Nakhon Si Ayutthaya": 834082, "Ayutthaya": 834082,
            "Phichit": 521401, "Nakhon Phanom": 717040, "Saraburi": 648321, "Loei": 638819,
            "Phitsanulok": 844494, "Trang": 638206, "Phetchaburi": 483329, "Sukhothai": 581374,
            "Ratchaburi": 865807, "Prachuap Khiri Khan": 560408, "Phayao": 455496, "Nan": 476727,
            "Uttaradit": 441052, "Phrae": 430669, "Nong Bua Lam Phu": 509489, "Yasothon": 531542,
            "Tak": 684140, "Samut Sakhon": 602227, "Mukdahan": 351658, "Sa Kaeo": 561938,
            "Lamphun": 399187, "Phangnga": 267994, "Phang Nga": 267994, "Phuket": 420993,
            "Narathiwat": 819669, "Pattani": 736733, "Satun": 327734, "Trat": 226922,
            "Sing Buri": 202657, "Ang Thong": 272587, "Nakhon Nayok": 260406, "Uthai Thani": 322624,
            "Prachin Buri": 498456, "Amnat Charoen": 372137, "Bueng Kan": 420280, "Phetchabun": 973386,
            "Maha Sarakham": 944605, "Suphan Buri": 825595, "Nong Khai": 515433, "Lop Buri": 735293,
            "Lampang": 718790, "Nakhon Sawan": 1021827, "Surat Thani": 1075788, "Pathum Thani": 1219199,
            "Mae Hong Son": 286000, "Phatthalung": 523000
        };

        // 2. ‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà (Area - sq.km) ‡πÇ‡∏î‡∏¢‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
        const areaDB = {
            "Bangkok": 1569, "Bangkok Metropolis": 1569,
            "Nakhon Ratchasima": 20494, "Chiang Mai": 20107, "Kanchanaburi": 19483, "Tak": 16406,
            "Ubon Ratchathani": 15744, "Surat Thani": 12891, "Chaiyaphum": 12778, "Mae Hong Son": 12681,
            "Phetchabun": 12668, "Lampang": 12534, "Udon Thani": 11730, "Chiang Rai": 11678,
            "Nan": 11472, "Loei": 11424, "Khon Kaen": 10886, "Phitsanulok": 10815,
            "Buriram": 10322, "Buri Ram": 10322, "Nakhon Si Thammarat": 9942, "Sakon Nakhon": 9605,
            "Nakhon Sawan": 9597, "Ratchaburi": 5196, "Trang": 4917, "Kamphaeng Phet": 8607,
            "Sisaket": 8840, "Si Sa Ket": 8840, "Roi Et": 8299, "Surin": 8124, "Uttaradit": 7838,
            "Songkhla": 7393, "Kalasin": 6946, "Sukhothai": 6596, "Phayao": 6335,
            "Prachuap Khiri Khan": 6367, "Chanthaburi": 6338, "Phetchaburi": 6225, "Chachoengsao": 5351,
            "Chumphon": 6009, "Phrae": 6538, "Maha Sarakham": 5291, "Sa Kaeo": 7195,
            "Nakhon Phanom": 5512, "Lop Buri": 6199, "Suphan Buri": 5358, "Chon Buri": 4363, "Chonburi": 4363,
            "Rayong": 3552, "Krabi": 4708, "Phichit": 4531, "Yala": 4521, "Lamphun": 4505,
            "Narathiwat": 4475, "Chai Nat": 2469, "Nong Khai": 3027, "Bueng Kan": 4305,
            "Phangnga": 4170, "Phang Nga": 4170, "Phatthalung": 3424, "Nong Bua Lam Phu": 3859,
            "Saraburi": 3576, "Yasothon": 4161, "Trat": 2819, "Prachin Buri": 4762,
            "Satun": 2478, "Ranong": 3298, "Mukdahan": 4339, "Pattani": 1940,
            "Phra Nakhon Si Ayutthaya": 2556, "Ayutthaya": 2556, "Nakhon Nayok": 2122,
            "Phuket": 543, "Pathum Thani": 1525, "Samut Prakan": 1004, "Samut Sakhon": 872,
            "Uthai Thani": 6730, "Amnat Charoen": 3161, "Nonthaburi": 622, "Ang Thong": 968,
            "Sing Buri": 822, "Samut Songkhram": 416
        };

        // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£ Global ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        let globalGeojson = null;
        let globalProvinces = [];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡πÇ‡∏´‡∏°‡∏î‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
        function getMapData(mode) {
            const dataValues = [];
            const hoverTexts = [];

            globalProvinces.forEach(name => {
                const cleanName = name.trim();
                const pop = populationDB[cleanName] || 0;
                const area = areaDB[cleanName] || 1; // ‡∏Å‡∏±‡∏ô‡∏´‡∏≤‡∏£‡∏î‡πâ‡∏ß‡∏¢ 0
                
                let value = 0;
                let text = "";

                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (Density)
                const density = (pop / area).toFixed(2);

                if (mode === 'pop') {
                    value = pop;
                    // Hover ‡πÇ‡∏ä‡∏ß‡πå‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Ñ‡πà‡∏≤‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏ä‡∏ô‡πå‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
                    text = `<b>${name}</b><br>üë• ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£: ${pop.toLocaleString()} ‡∏Ñ‡∏ô<br>üìê ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà: ${area.toLocaleString()} ‡∏ï‡∏£.‡∏Å‡∏°.<br>üìä ‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô: ${density} ‡∏Ñ‡∏ô/‡∏ï‡∏£.‡∏Å‡∏°.`;
                } else {
                    value = parseFloat(density);
                    text = `<b>${name}</b><br>üìä ‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô: ${density} ‡∏Ñ‡∏ô/‡∏ï‡∏£.‡∏Å‡∏°.<br>üë• ‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£: ${pop.toLocaleString()} ‡∏Ñ‡∏ô`;
                }

                dataValues.push(value);
                hoverTexts.push(text);
            });

            return { values: dataValues, texts: hoverTexts };
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ß‡∏≤‡∏î‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà
        function drawMap(mode) {
            const mapData = getMapData(mode);

            // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏µ:
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 'pop' ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (Brand Blue)
            // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô 'density' ‡πÉ‡∏ä‡πâ‡πÇ‡∏ó‡∏ô‡∏™‡πâ‡∏°-‡πÅ‡∏î‡∏á (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô)
            let colorScale = [];
            let zMax = 0;
            let title = "";

            if (mode === 'pop') {
                // ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô (Professional Blue Gradient)
                colorScale = [
                    [0, '#e3f2fd'], [0.2, '#90caf9'], [0.4, '#42a5f5'],
                    [0.6, '#1e88e5'], [0.8, '#1565c0'], [1.0, '#0d47a1'] // ‡∏ô‡πâ‡∏≥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏°‡∏™‡∏∏‡∏î
                ];
                zMax = 3000000;
                title = "‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ 2567";
            } else {
                // ‡πÇ‡∏ó‡∏ô‡∏™‡∏µ‡πÅ‡∏î‡∏á-‡∏™‡πâ‡∏° (Density Heatmap)
                colorScale = [
                    [0, '#fff3e0'], [0.2, '#ffcc80'], [0.4, '#ffb74d'],
                    [0.6, '#ff9800'], [0.8, '#f57c00'], [1.0, '#e65100']
                ];
                zMax = 1500; // ‡∏ï‡∏±‡∏î‡∏ó‡∏µ‡πà 1500 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏´‡πá‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πà‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô (‡πÄ‡∏û‡∏£‡∏≤‡∏∞ ‡∏Å‡∏ó‡∏°. ‡πÇ‡∏î‡∏î‡πÑ‡∏õ 3000+)
                title = "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏ô‡∏≤‡πÅ‡∏ô‡πà‡∏ô (‡∏Ñ‡∏ô/‡∏ï‡∏£.‡∏Å‡∏°.)";
            }

            // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠
            document.getElementById('titleText').innerText = title;

            const data = [{
                type: "choroplethmapbox",
                geojson: globalGeojson,
                locations: globalProvinces,
                featureidkey: "properties.name",
                z: mapData.values,
                colorscale: colorScale,
                zmin: 0,
                zmax: zMax,
                marker: { opacity: 0.8, line: { width: 0.5, color: 'white' } },
                text: mapData.texts,
                hovertemplate: "%{text}<extra></extra>"
            }];

            const layout = {
                margin: { r: 0, t: 0, l: 0, b: 0 },
                mapbox: {
                    style: "carto-positron", // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏™‡∏∞‡∏≠‡∏≤‡∏î‡∏ï‡∏≤
                    center: { lat: 13.736717, lon: 100.523186 },
                    zoom: 5.2
                },
                // ‡∏ã‡πà‡∏≠‡∏ô Modebar ‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á Plotly ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏ä‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡πÅ‡∏ó‡∏ô
                modebar: { displayModeBar: false } 
            };
            
            // ‡πÉ‡∏ä‡πâ react ‡πÅ‡∏ó‡∏ô newPlot ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ó‡∏µ‡πà‡∏•‡∏∑‡πà‡∏ô‡πÑ‡∏´‡∏•
            Plotly.react('myDiv', data, layout, {responsive: true, displayModeBar: false});
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏°‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Dropdown
        function updateMapMode() {
            const selector = document.getElementById('dataSelector');
            drawMap(selector.value);
        }

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô Export ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
        function exportMap() {
            Plotly.downloadImage('myDiv', {
                format: 'png', 
                width: 1200, 
                height: 800, 
                filename: 'Thailand_Map_2024'
            });
        }

        // --- ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ---
        const geojsonUrl = 'https://raw.githubusercontent.com/apisit/thailand.json/master/thailand.json';

        fetch(geojsonUrl)
            .then(response => response.json())
            .then(geojson => {
                globalGeojson = geojson;
                globalProvinces = geojson.features.map(feature => feature.properties.name);
                
                // ‡∏ß‡∏≤‡∏î‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å (Default: Population)
                drawMap('pop');
            })
            .catch(error => console.error('Error:', error));
    </script>

</body>
</html>
